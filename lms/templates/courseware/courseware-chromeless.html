<%page expression_filter="h"/>
<%inherit file="/main.html" />
<%namespace name='static' file='/static_content.html'/>
<%!
from django.utils.translation import ugettext as _
from django.conf import settings
from edxnotes.helpers import is_feature_enabled as is_edxnotes_enabled

from openedx.core.djangolib.markup import HTML
from openedx.core.djangolib.js_utils import js_escaped_string
%>
<%def name="course_name()">
 <% return _("{course_number} Courseware").format(course_number=course.display_number_with_default) %>
</%def>

<%block name="bodyclass">view-in-course view-courseware courseware ${course.css_class or ''}</%block>
<%block name="title"><title>
    % if section_title:
${static.get_page_title_breadcrumbs(section_title, course_name())}
    % else:
${static.get_page_title_breadcrumbs(course_name())}
    %endif
</title></%block>

<%block name="header_extras">
% for template_name in ["image-modal"]:
<script type="text/template" id="${template_name}-tpl">
    <%static:include path="common/templates/${template_name}.underscore" />
</script>
% endfor
<%
  header_file = None
%>
</%block>

<%
if course is not None:
    include_special_exams = settings.FEATURES.get('ENABLE_SPECIAL_EXAMS', False) and (course.enable_proctored_exams or course.enable_timed_exams)
%>

<%block name="headextra">
<%static:css group='style-course-vendor'/>
<%static:css group='style-course'/>
## Utility: Notes
% if is_edxnotes_enabled(course, request.user):
<%static:css group='style-student-notes'/>
% endif

<script type="text/javascript" src="${static.url('js/jquery.autocomplete.js')}"></script>
<script type="text/javascript" src="${static.url('js/src/tooltip_manager.js')}"></script>

<link href="${static.url('css/vendor/jquery.autocomplete.css')}" rel="stylesheet" type="text/css">
  ${HTML(fragment.head_html())}
</%block>

<%block name="js_extra">
  <script type="text/javascript" src="${static.url('common/js/vendor/jquery.scrollTo.js')}"></script>
  <script type="text/javascript" src="${static.url('js/vendor/flot/jquery.flot.js')}"></script>

  <%static:js group='courseware'/>

  <%include file="/mathjax_include.html" args="disable_fast_preview=True"/>
  % if staff_access:
  	<%include file="xqa_interface.html"/>
  % endif

  <script type="text/javascript">
    window.chromlessView = true;
    var $$course_id = "${course.id | n, js_escaped_string}";

    $( document ).ready(function() {

      function inIframe() {
        try {
          return window.self !== window.top;
        } catch (e) {
          return true;
        }
      }

      function postMessageResize() {
        var height = document.body.offsetHeight;
        var width = document.body.offsetWidth;
        window.parent.postMessage("resize::" + height + ":" + width, "*");
      }

      if (inIframe()) {
        postMessageResize();
      }
    })
  </script>

${HTML(fragment.foot_html())}

</%block>

<div class="proctored_exam_status"></div>
<div class="scores-panel is-hidden"></div>
<div class="course-wrapper chromeless">
    % if include_special_exams is not UNDEFINED and include_special_exams:
        <%static:js group='proctoring'/>
        % for template_name in ["proctored-exam-status"]:
            <script type="text/template" id="${template_name}-tpl">
                <%static:include path="courseware/${template_name}.underscore" />
            </script>
        % endfor
    % endif
  <section class="course-content" id="course-content"\
    % if enable_completion_on_view_service:
      data-enable-completion-on-view-service="true" \
    % else:
      data-enable-completion-on-view-service="false" \
    % endif
  >
      <main id="main" tabindex="-1" aria-label="Content">
        ${HTML(fragment.body_html())}
      </main>
  </section>
</div>
% if course.show_calculator or is_edxnotes_enabled(course, request.user):
    <nav class="nav-utilities ${"has-utility-calculator" if course.show_calculator else ""}" aria-label="${_('Course Utilities')}">
      ## Utility: Notes
      % if is_edxnotes_enabled(course, request.user):
        <%include file="/edxnotes/toggle_notes.html" args="course=course"/>
      % endif

      ## Utility: Calc
      % if course.show_calculator:
        <%include file="/calculator/toggle_calculator.html" />
      % endif
    </nav>
% endif
